/*
 * datawrapper / vis / column-chart v1.5.0
 * generated on 2014-07-30T05:38:12+02:00
 */
(function(){var root=this,dw={};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=dw;}
exports.dw=dw;}else{window.dw=dw;}
dw.dataset=function(columns,opts){var columnsByName={},origColumns=columns.slice(0);_.each(columns,function(col){uniqueName(col);columnsByName[col.name()]=col;});opts=_.extend(opts,{});function uniqueName(col){var origColName=col.name(),colName=origColName,appendix=1;while(columnsByName.hasOwnProperty(colName)){colName=origColName+'.'+(appendix++);}
if(colName!=origColName)col.name(colName);}
var dataset={columns:function(){return columns;},column:function(x){if(_.isString(x)){if(columnsByName[x]!==undefined)return columnsByName[x];throw'No column found with that name: "'+x+'"';}
if(columns[x]!==undefined)return columns[x];throw'No column found with that index: '+x;},numColumns:function(){return columns.length;},numRows:function(){return columns[0].length;},eachColumn:function(func){_.each(columns,func);},hasColumn:function(x){return(_.isString(x)?columnsByName[x]:columns[x])!==undefined;},indexOf:function(column_name){if(!dataset.hasColumn(column_name))return-1;return _.indexOf(columns,columnsByName[column_name]);},toCSV:function(){var csv="",sep=",",quote="\"";_.each(columns,function(col,i){var t=col.title();if(t.indexOf(quote)>-1)t.replace(quote,'\\'+quote);if(t.indexOf(sep)>-1)t=quote+t+quote;csv+=(i>0?sep:'')+t;});_.each(_.range(dataset.numRows()),function(row){csv+='\n';_.each(columns,function(col,i){var t=''+(col.type()=='date'?col.raw(row):col.val(row));if(t.indexOf(quote)>-1)t.replace(quote,'\\'+quote);if(t.indexOf(sep)>-1)t=quote+t+quote;csv+=(i>0?sep:'')+t;});});return csv;},filterColumns:function(ignore){columns=_.filter(columns,function(c){return!ignore[c.name()];});_.each(ignore,function(ign,key){if(ign&&columnsByName[key])delete columnsByName[key];});return dataset;},eachRow:function(func){var i;for(i=0;i<dataset.numRows();i++){func(i);}
return dataset;},add:function(column){uniqueName(column);columns.push(column);columnsByName[column.name()]=column;return dataset;},reset:function(){columns=origColumns.slice(0);columnsByName={};_.each(columns,function(col){columnsByName[col.name()]=col;});return dataset;}};return dataset;};dw.column=function(name,rows,type){function guessType(sample){if(_.every(rows,_.isNumber))return dw.column.types.number();if(_.every(rows,_.isDate))return dw.column.types.date();var types=[dw.column.types.date(sample),dw.column.types.number(sample),dw.column.types.text()],type,k=rows.length,tolerance=0.1;_.each(rows,function(val){_.each(types,function(t){t.parse(val);});});_.every(types,function(t){if(t.errors()/k<tolerance)type=t;return!type;});return type;}
var sample=_.map(_.shuffle(_.range(rows.length)).slice(0,200),function(i){return rows[i];});type=type?dw.column.types[type](sample):guessType(sample);var range,total,origRows=rows.slice(0),title;var column={name:function(){if(arguments.length){name=arguments[0];return column;}
return dw.utils.purifyHtml(name);},title:function(){if(arguments.length){title=arguments[0];return column;}
return dw.utils.purifyHtml(title||name);},length:rows.length,val:function(i,unfiltered){if(!arguments.length)return undefined;var r=unfiltered?origRows:rows;if(i<0)i+=r.length;return type.parse(dw.utils.purifyHtml(r[i]));},values:function(unfiltered){var r=unfiltered?origRows:rows;r=_.map(r,dw.utils.purifyHtml);return _.map(r,type.parse);},each:function(f){for(i=0;i<rows.length;i++){f(column.val(i),i);}},raw:function(i,val){if(!arguments.length)return rows;if(arguments.length==2){rows[i]=val;return column;}
return dw.utils.purifyHtml(rows[i]);},type:function(o){if(o===true)return type;if(_.isString(o)){if(dw.column.types[o]){type=dw.column.types[o](sample);return column;}else{throw'unknown column type: '+o;}}
return type.name();},range:function(){if(!type.toNum)return false;if(!range){range=[Number.MAX_VALUE,-Number.MAX_VALUE];column.each(function(v){v=type.toNum(v);if(!_.isNumber(v)||_.isNaN(v))return;if(v<range[0])range[0]=v;if(v>range[1])range[1]=v;});range[0]=type.fromNum(range[0]);range[1]=type.fromNum(range[1]);}
return range;},total:function(){if(!type.toNum)return false;if(!total){total=0;column.each(function(v){total+=type.toNum(v);});total=type.fromNum(total);}
return total;},filterRows:function(r){rows=[];if(arguments.length){_.each(r,function(i){rows.push(origRows[i]);});}else{rows=origRows.slice(0);}
column.length=rows.length;range=total=false;return column;},toString:function(){return name+' ('+type.name()+')';},indexOf:function(val){return _.find(_.range(rows.length),function(i){return column.val(i)==val;});}};return column;};dw.column.types={};dw.column.types.text=function(){return{parse:_.identity,errors:function(){return 0;},name:function(){return'text';},formatter:function(){return _.identity;},isValid:function(){return true;},format:function(){}};};dw.column.types.number=function(sample){function signDigitsDecimalPlaces(num,sig){if(num===0)return 0;return Math.round(sig-Math.ceil(Math.log(Math.abs(num))/Math.LN10));}
var format,errors=0,knownFormats={'-.':/^ *[-–—]?[0-9]*(\.[0-9]+)?(e[\+\-][0-9]+)?%? *$/,'-,':/^ *[-–—]?[0-9]*(,[0-9]+)?%? *$/,',.':/^ *[-–—]?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)?%? *$/,'.,':/^ *[-–—]?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)?%? *$/,' .':/^ *[-–—]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/,' ,':/^ *[-–—]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/,' .':/^ *[-–—]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/,' ,':/^ *[-–—]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/},formatLabels={'-.':'1234.56','-,':'1234,56',',.':'1,234.56','.,':'1.234,56',' .':'1 234.56',' ,':'1 234,56',' .':'1 234.56',' ,':'1 234,56'},naStrings={'na':1,'n/a':1,'-':1,':':1};var matches={},bestMatch=['-.',0];sample=sample||[];_.each(sample,function(n){_.each(knownFormats,function(regex,fmt){if(matches[fmt]===undefined)matches[fmt]=0;if(regex.test(n)){matches[fmt]+=1;if(matches[fmt]>bestMatch[1]){bestMatch[0]=fmt;bestMatch[1]=matches[fmt];}}});});format=bestMatch[0];var type={parse:function(raw){if(_.isNumber(raw)||_.isUndefined(raw)||_.isNull(raw))return raw;var number=raw.replace("%","").replace('–','-').replace('—','-');if(format[0]!='-'){number=number.replace(format[0],'');}
if(format[1]!='.'){number=number.replace(format[1],'.');}
if(isNaN(number)||number===""){if(!naStrings[number.toLowerCase()]&&number!=="")errors++;return raw;}
return Number(number);},toNum:function(i){return i;},fromNum:function(i){return i;},errors:function(){return errors;},name:function(){return'number';},formatter:function(config){var format=config['number-format']||'-',div=Number(config['number-divisor']||0),append=(config['number-append']||'').replace(/ /g,'\u00A0'),prepend=(config['number-prepend']||'').replace(/ /g,'\u00A0');return function(val,full,round){if(isNaN(val))return val;var _fmt=format;if(div!==0&&_fmt=='-')_fmt='n1';if(div!==0)val=Number(val)/Math.pow(10,div);if(_fmt.substr(0,1)=='s'){var sig=+_fmt.substr(1);_fmt='n'+Math.max(0,signDigitsDecimalPlaces(val,sig));}
if(round)_fmt='n0';val=Globalize.format(val,_fmt!='-'?_fmt:null);return full?prepend+val+append:val;};},isValid:function(val){return val===""||naStrings[String(val).toLowerCase()]||_.isNumber(type.parse(val));},ambiguousFormats:function(){var candidates=[];_.each(matches,function(cnt,fmt){if(cnt==bestMatch[1]){candidates.push([fmt,formatLabels[fmt]]);}});return candidates;},format:function(fmt){if(arguments.length){format=fmt;return type;}
return format;}};return type;};dw.column.types.date=function(sample){var format,errors=0,matches={},bestMatch=['',0],knownFormats={'YYYY':{test:/^ *(?:1[7-9]|20)\d{2} *$/,parse:/^ *(\d{4}) *$/,precision:'year'},'YYYY-H':{test:/^ *[12]\d{3}[ \-\/]?[hH][12] *$/,parse:/^ *(\d{4})[ \-\/]?[hH]([12]) *$/,precision:'half'},'H-YYYY':{test:/^ *[hH][12][ \-\/][12]\d{3} *$/,parse:/^ *[hH]([12])[ \-\/](\d{4}) *$/,precision:'half'},'YYYY-Q':{test:/^ *[12]\d{3}[ \-\/]?[qQ][1234] *$/,parse:/^ *(\d{4})[ \-\/]?[qQ]([1234]) *$/,precision:'quarter'},'Q-YYYY':{test:/^ *[qQ]([1234])[ \-\/][12]\d{3} *$/,parse:/^ *[qQ]([1234])[ \-\/](\d{4}) *$/,precision:'quarter'},'YYYY-M':{test:/^ *([12]\d{3}) ?[ \-\/\.mM](0?[1-9]|1[0-2]) *$/,parse:/^ *(\d{4}) ?[ \-\/\.mM](0?[1-9]|1[0-2]) *$/,precision:'month'},'M-YYYY':{test:/^ *(0?[1-9]|1[0-2]) ?[ \-\/\.][12]\d{3} *$/,parse:/^ *(0?[1-9]|1[0-2]) ?[ \-\/\.](\d{4}) *$/,precision:'month'},'YYYY-WW':{test:/^ *[12]\d{3}[ -]?[wW](0?[1-9]|[1-4]\d|5[0-3]) *$/,parse:/^ *(\d{4})[ -]?[wW](0?[1-9]|[1-4]\d|5[0-3]) *$/,precision:'week'},'MM/DD/YYYY':{test:/^ *(0?[1-9]|1[0-2])([\-\/] ?)(0?[1-9]|[1-2]\d|3[01])\2([12]\d{3})$/,parse:/^ *(0?[1-9]|1[0-2])([\-\/] ?)(0?[1-9]|[1-2]\d|3[01])\2(\d{4})$/,precision:'day'},'DD/MM/YYYY':{test:/^ *(0?[1-9]|[1-2]\d|3[01])([\-\.\/ ?])(0?[1-9]|1[0-2])\2([12]\d{3})$/,parse:/^ *(0?[1-9]|[1-2]\d|3[01])([\-\.\/ ?])(0?[1-9]|1[0-2])\2(\d{4})$/,precision:'day'},'YYYY-MM-DD':{test:/^ *([12]\d{3})([\-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2]\d|3[01])$/,parse:/^ *(\d{4})([\-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2]\d|3[01])$/,precision:'day'},'YYYY-WW-d':{test:/^ *[12]\d{3}[ \-]?[wW](0?[1-9]|[1-4]\d|5[0-3])(?:[ \-]?[1-7]) *$/,parse:/^ *(\d{4})[ \-]?[wW](0?[1-9]|[1-4]\d|5[0-3])(?:[ \-]?([1-7])) *$/,precision:'day'},'MM/DD/YYYY HH:MM':{test:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2]\d|3[01])\2([12]\d{3}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d) *$/,parse:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2]\d|3[01])\2(\d{4}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d) *$/,precision:'day-minutes'},'DD.MM.YYYY HH:MM':{test:/^ *(0?[1-9]|[1-2]\d|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2([12]\d{3}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d) *$/,parse:/^ *(0?[1-9]|[1-2]\d|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2(\d{4}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d) *$/,precision:'day-minutes'},'YYYY-MM-DD HH:MM':{test:/^ *([12]\d{3})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2]\d|3[01]) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d) *$/,parse:/^ *(\d{4})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2]\d|3[01]) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d) *$/,precision:'day-minutes'},'MM/DD/YYYY HH:MM:SS':{test:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2]\d|3[01])\2([12]\d{3}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *$/,parse:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2]\d|3[01])\2(\d{4}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *$/,precision:'day-seconds'},'DD.MM.YYYY HH:MM:SS':{test:/^ *(0?[1-9]|[1-2]\d|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2([12]\d{3}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *$/,parse:/^ *(0?[1-9]|[1-2]\d|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2(\d{4}) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *$/,precision:'day-seconds'},'YYYY-MM-DD HH:MM:SS':{test:/^ *([12]\d{3})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2]\d|3[01]) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *$/,parse:/^ *(\d{4})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2]\d|3[01]) *[ \-\|] *(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *$/,precision:'day-seconds'}};function test(str,key){var fmt=knownFormats[key];if(_.isRegExp(fmt.test)){return fmt.test.test(str);}else{return fmt.test(str,key);}}
function parse(str,key){var fmt=knownFormats[key];if(_.isRegExp(fmt.parse)){return str.match(fmt.parse);}else{return fmt.parse(str,key);}}
sample=sample||[];_.each(knownFormats,function(format,key){_.each(sample,function(n){if(matches[key]===undefined)matches[key]=0;if(test(n,key)){matches[key]+=1;if(matches[key]>bestMatch[1]){bestMatch[0]=key;bestMatch[1]=matches[key];}}});});format=bestMatch[0];function dateFromIsoWeek(year,week,day){var d=new Date(Date.UTC(year,0,3));d.setUTCDate(3-d.getUTCDay()+(week-1)*7+parseInt(day,10));return d;}
function dateToIsoWeek(date){var d=date.getUTCDay(),t=new Date(date.valueOf());t.setDate(t.getDate()-((d+6)%7)+3);var iso_year=t.getUTCFullYear(),w=Math.floor((t.getTime()-new Date(iso_year,0,1,-6))/864e5);return[iso_year,1+Math.floor(w/7),d>0?d:7];}
var type={parse:function(raw){if(_.isDate(raw)||_.isUndefined(raw))return raw;if(!format||!_.isString(raw)){errors++;return raw;}
var m=parse(raw,format);if(!m){errors++;return raw;}else{if(!test(raw,format))errors++;}
switch(format){case'YYYY':return new Date(m[1],0,1);case'YYYY-H':return new Date(m[1],(m[2]-1)*6,1);case'H-YYYY':return new Date(m[2],(m[1]-1)*6,1);case'YYYY-Q':return new Date(m[1],(m[2]-1)*3,1);case'Q-YYYY':return new Date(m[2],(m[1]-1)*3,1);case'YYYY-M':return new Date(m[1],(m[2]-1),1);case'M-YYYY':return new Date(m[2],(m[1]-1),1);case'YYYY-WW':return dateFromIsoWeek(m[1],m[2],1);case'YYYY-WW-d':return dateFromIsoWeek(m[1],m[2],m[3]);case'YYYY-MM-DD':return new Date(m[1],(m[3]-1),m[4]);case'DD/MM/YYYY':return new Date(m[4],(m[3]-1),m[1]);case'MM/DD/YYYY':return new Date(m[4],(m[1]-1),m[3]);case'YYYY-MM-DD HH:MM':return new Date(m[1],(m[3]-1),m[4],m[5]||0,m[6]||0,0);case'DD.MM.YYYY HH:MM':return new Date(m[4],(m[3]-1),m[1],m[5]||0,m[6]||0,0);case'MM/DD/YYYY HH:MM':return new Date(m[4],(m[1]-1),m[3],m[5]||0,m[6]||0,0);case'YYYY-MM-DD HH:MM:SS':return new Date(m[1],(m[3]-1),m[4],m[5]||0,m[6]||0,m[7]||0);case'DD.MM.YYYY HH:MM:SS':return new Date(m[4],(m[3]-1),m[1],m[5]||0,m[6]||0,m[7]||0);case'MM/DD/YYYY HH:MM:SS':return new Date(m[4],(m[1]-1),m[3],m[5]||0,m[6]||0,m[7]||0);}
errors++;return raw;},toNum:function(d){return d.getTime();},fromNum:function(i){return new Date(i);},errors:function(){return errors;},name:function(){return'date';},format:function(fmt){if(arguments.length){format=fmt;return type;}
return format;},precision:function(){return knownFormats[format].precision;},formatter:function(config){if(!format)return _.identity;var M_pattern=Globalize.culture().calendar.patterns.M.replace('MMMM','MMM');switch(knownFormats[format].precision){case'year':return function(d){return!_.isDate(d)?d:d.getFullYear();};case'half':return function(d){return!_.isDate(d)?d:d.getFullYear()+' H'+(d.getMonth()/6+1);};case'quarter':return function(d){return!_.isDate(d)?d:d.getFullYear()+' Q'+(d.getMonth()/3+1);};case'month':return function(d){return!_.isDate(d)?d:Globalize.format(d,'MMM yy');};case'week':return function(d){return!_.isDate(d)?d:dateToIsoWeek(d).slice(0,2).join(' W');};case'day':return function(d,verbose){return!_.isDate(d)?d:Globalize.format(d,verbose?'D':'d');};case'day-minutes':return function(d){return!_.isDate(d)?d:Globalize.format(d,M_pattern).replace(' ','&nbsp;')+' - '+Globalize.format(d,'t').replace(' ','&nbsp;');};case'day-seconds':return function(d){return!_.isDate(d)?d:Globalize.format(d,'T').replace(' ','&nbsp;');};}},isValid:function(val){return _.isDate(type.parse(val));},ambiguousFormats:function(){var candidates=[];_.each(matches,function(cnt,fmt){if(cnt==bestMatch[1]){candidates.push([fmt,fmt]);}});return candidates;}};return type;};dw.datasource={};dw.datasource.delimited=function(opts){function loadAndParseCsv(){if(opts.url){return $.ajax({url:opts.url,method:'GET',dataType:"text"}).then(function(raw){return new DelimitedParser(opts).parse(raw);});}else if(opts.csv){var dfd=$.Deferred(),parsed=dfd.then(function(raw){return new DelimitedParser(opts).parse(raw);});dfd.resolve(opts.csv);return parsed;}
throw'you need to provide either an URL or CSV data.';}
var delimited={dataset:loadAndParseCsv};return delimited;};var DelimitedParser=function(opts){opts=_.extend({delimiter:"auto",quoteChar:"\"",skipRows:0,emptyValue:null,transpose:false,firstRowIsHeader:true},opts);this.__delimiterPatterns=getDelimiterPatterns(opts.delimiter,opts.quoteChar);this.opts=opts;};function getDelimiterPatterns(delimiter,quoteChar){return new RegExp(("(\\"+delimiter+"|\\r?\\n|\\r|^)"+"(?:"+quoteChar+"([^"+quoteChar+"]*(?:"+quoteChar+"\"[^"+quoteChar+"]*)*)"+quoteChar+"|"+"([^"+quoteChar+"\\"+delimiter+"\\r\\n]*))"),"gi");}
_.extend(DelimitedParser.prototype,{parse:function(data){var me=this,opts=this.opts;me.__rawData=data;if(opts.delimiter=='auto'){opts.delimiter=me.guessDelimiter(data,opts.skipRows);me.__delimiterPatterns=getDelimiterPatterns(opts.delimiter,opts.quoteChar);}
var columns=[],closure=opts.delimiter!='|'?'|':'#',arrData;data=closure+data.replace(/\s+$/g,'')+closure;function parseCSV(delimiterPattern,strData,strDelimiter){strDelimiter=(strDelimiter||",");var arrData=[[]];var arrMatches=null,strMatchedValue;while(arrMatches=delimiterPattern.exec(strData)){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&(strMatchedDelimiter!=strDelimiter)){arrData.push([]);}
if(arrMatches[2]){strMatchedValue=arrMatches[2].replace(new RegExp("\"\"","g"),"\"");}else{strMatchedValue=arrMatches[3];}
arrData[arrData.length-1].push(strMatchedValue);}
if(arrData[0][0].substr(0,1)==closure){arrData[0][0]=arrData[0][0].substr(1);}
var p=arrData.length-1,q=arrData[p].length-1,r=arrData[p][q].length-1;if(arrData[p][q].substr(r)==closure){arrData[p][q]=arrData[p][q].substr(0,r);}
return(arrData);}
function transpose(arrMatrix){var a=arrMatrix,w=a.length?a.length:0,h=a[0]instanceof Array?a[0].length:0;if(h===0||w===0){return[];}
var i,j,t=[];for(i=0;i<h;i++){t[i]=[];for(j=0;j<w;j++){t[i][j]=a[j][i];}}
return t;}
function makeDataset(arrData){var columns=[],columnNames={},rowCount=arrData.length,columnCount=arrData[0].length,rowIndex=opts.skipRows;var srcColumns=[];if(opts.firstRowIsHeader){srcColumns=arrData[rowIndex];rowIndex++;}
for(var c=0;c<columnCount;c++){var col=_.isString(srcColumns[c])?srcColumns[c].replace(/^\s+|\s+$/g,''):'',suffix=col!==''?'':1;col=col!==''?col:'X.';while(columnNames[col+suffix]!==undefined){suffix=suffix===''?1:suffix+1;}
columns.push({name:col+suffix,data:[]});columnNames[col+suffix]=true;}
_.each(_.range(rowIndex,rowCount),function(row){_.each(columns,function(c,i){c.data.push(arrData[row][i]!==''?arrData[row][i]:opts.emptyValue);});});columns=_.map(columns,function(c){return dw.column(c.name,c.data);});return dw.dataset(columns);}
arrData=parseCSV(this.__delimiterPatterns,data,opts.delimiter);if(opts.transpose){arrData=transpose(arrData);}
return makeDataset(arrData);},guessDelimiter:function(strData){var maxMatchCount=0,k=-1,me=this,delimiters=['\t',';','|',','];_.each(delimiters,function(delimiter,i){var regex=getDelimiterPatterns(delimiter,me.quoteChar),c=strData.match(regex).length;if(c>maxMatchCount){maxMatchCount=c;k=i;}});return delimiters[k];}});dw.utils={minMax:function(columns){var minmax=[Number.MAX_VALUE,-Number.MAX_VALUE];_.each(columns,function(column){minmax[0]=Math.min(minmax[0],column.range()[0]);minmax[1]=Math.max(minmax[1],column.range()[1]);});return minmax;},dateFormat:function(daysDelta){var new_month=true,last_date=false;function timeFormat(formats){return function(date){new_month=!last_date||date.getMonth()!=last_date.getMonth();last_date=date;var i=formats.length-1,f=formats[i];while(!f[1](date))f=formats[--i];return f[0](date);};}
function time_fmt(fmt){var format=function(date){var r=Globalize.format(date,fmt);return fmt!='htt'?r:r.toLowerCase();};return format;}
var fmt=(function(lang){return{date:lang=='de'?"dd.":"dd",hour:lang!='en'?"H:00":"htt",minute:lang=='de'?"H:mm":'h:mm',mm:lang=='de'?'d.M.':'MM/dd',mmm:lang=='de'?'d.MMM':'MMM dd',mmmm:lang=='de'?'d. MMMM':'MMMM dd'};})(Globalize.culture().language);return timeFormat([[time_fmt("yyyy"),function(){return true;}],[time_fmt(daysDelta>70?"MMM":"MMM"),function(d){return d.getMonth()!==0;}],[time_fmt(fmt.date),function(d){return d.getDate()!=1;}],[time_fmt(daysDelta<7?fmt.mm:daysDelta>70?fmt.mmm:fmt.mmm),function(d){return d.getDate()!=1&&new_month;}],[time_fmt(fmt.hour),function(d){return d.getHours();}],[time_fmt(fmt.minute),function(d){return d.getMinutes();}],[time_fmt(":ss"),function(d){return d.getSeconds();}],[time_fmt(".fff"),function(d){return d.getMilliseconds();}]]);},longDateFormat:function(column){var me=this;return function(d){if(column.type()=='date'){switch(column.type(true).precision()){case'year':return d.getFullYear();case'quarter':return d.getFullYear()+' Q'+(d.getMonth()/3+1);case'month':return Globalize.format(d,'MMM yy');case'day':return Globalize.format(d,'MMM d');case'minute':return Globalize.format(d,'t');case'second':return Globalize.format(d,'T');}}else{return d;}};},columnNameColumn:function(columns){var names=_.map(columns,function(col){return col.title();});return dw.column('',names);},name:function(obj){return _.isFunction(obj.name)?obj.name():_.isString(obj.name)?obj.name:obj;},getMaxChartHeight:function(el){function margin(el,type){if($(el).css('margin-'+type)=='auto')return 0;return+$(el).css('margin-'+type).replace('px','');}
var ch=0,bottom=0;$('body > *').each(function(i,el){var t=el.tagName.toLowerCase();if(t!='script'&&el.id!='chart'&&!$(el).hasClass('tooltip')&&!$(el).hasClass('qtip')&&!$(el).hasClass('container')&&!$(el).hasClass('noscript')){ch+=$(el).outerHeight(false);}
ch+=Math.max(margin(el,'top'),bottom);bottom=margin(el,'bottom');});ch+=bottom;var mt=$('#chart').css('margin-top').replace('px',''),mb=$('#chart').css('margin-bottom').replace('px',''),maxH=$(window).height()-ch-8;if(!$.support.leadingWhitespace)maxH-=15;maxH-=$('body').css('padding-top').replace('px','');maxH-=$('body').css('padding-bottom').replace('px','');return maxH;},purifyHtml:function(input,allowed){var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,default_allowed="<b><br><br/><i><strong><sup><sub><strike><u><em><tt>",allowed_split={};if(allowed===undefined)allowed=default_allowed;allowed_split[allowed]=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');function purifyHtml(input,allowed){if(!_.isString(input)||input.indexOf("<")<0){return input;}
if(allowed===undefined){allowed=default_allowed;}
if(!allowed_split[allowed]){allowed_split[allowed]=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');}
return input.replace(commentsAndPhpTags,'').replace(tags,function($0,$1){return allowed_split[allowed].indexOf('<'+$1.toLowerCase()+'>')>-1?$0:'';});}
dw.utils.purifyHtml=purifyHtml;return purifyHtml(input,allowed);},significantDimension:function(values){var result=[],dimension=0,nonEqual=true,uniqValues=_.uniq(values),check,diff;if(uniqValues.length==1){return-1*Math.floor(Math.log(uniqValues[0])/Math.LN10);}
if(_.uniq(_.map(uniqValues,round)).length==uniqValues.length){check=function(){return _.uniq(result).length==uniqValues.length;};diff=-1;}else{check=function(){return _.uniq(result).length<uniqValues.length;};diff=+1;}
var max_iter=100;do{result=_.map(uniqValues,round);dimension+=diff;}while(check()&&max_iter-->0);if(max_iter<10){console.warn('maximum iteration reached',values,result,dimension);}
if(diff<0)dimension+=2;else dimension--;function round(v){return dw.utils.round(v,dimension);}
return dimension;},round:function(value,dimension){var base=Math.pow(10,dimension);return Math.round(value*base)/base;},smartRound:function(values,add_precision){var dim=dw.utils.significantDimension(values);dim+=add_precision||0;return _.map(values,function(v){return dw.utils.round(v,dim);});},nearest:function(array,value){var min_diff=Number.MAX_VALUE,min_diff_val;_.each(array,function(v){var d=Math.abs(v-value);if(d<min_diff){min_diff=d;min_diff_val=v;}});return min_diff_val;},metricSuffix:function(locale){switch(locale.substr(0,2).toLowerCase()){case'de':return{3:' Tsd.',6:' Mio.',9:' Mrd.',12:' Bio.'};case'fr':return{3:' mil',6:' Mio',9:' Mrd'};case'es':return{3:' Mil',6:' millón'};default:return{3:'k',6:'M',9:' bil'};}},magnitudeRange:function(minmax){var e0=Math.round(Math.log(minmax[0])/Math.LN10),e1=Math.round(Math.log(minmax[1])/Math.LN10);return e1-e0;},logTicks:function(min,max){var e0=Math.round(Math.log(min)/Math.LN10),e1=Math.round(Math.log(max)/Math.LN10);return _.map(_.range(e0,e1),function(exp){return Math.pow(10,exp);});}};dw.utils.filter=function(column,active,type,format){var callbacks=[],lastActiveRow;type=type||'auto';format=format||_.identity;if(type=='auto'){if(column.type()=='date')type='timescale';else if(column.type()=='text')type=column.length<6?'buttons':'select';}
var filter={ui:getFilterUI(type),change:function(callback){callbacks.push(callback);}};function update(i){_.each(callbacks,function(cb){if(_.isFunction(cb)){cb(column.val(i),i);}});}
function getFilterUI(type){var f;if(type=='auto'){type=column.type()=='date'?'timescale':column.length<6?'buttons':'select';}
if(column.length<2)return function(){return false;};if(type=='select')f=function(vis){var select=$('<select />');column.each(function(val,i){var lbl=format(val);if(!lbl)return;select.append('<option value="'+i+'">'+(_.isString(lbl)?$.trim(lbl):lbl)+'</option>');});select.change(function(evt){var cur=select.val();update(cur);});select.addClass('filter-ui filter-select');return select;};if(type=='buttons')f=function(vis){var div=$('<div />');div.addClass('filter-ui filter-links');column.each(function(val,i){var lbl=format(val);if(!lbl)return;var a=$('<a href="#'+i+'"'+(i==active?' class="active" ':'')+'>'+(_.isString(lbl)?$.trim(lbl):lbl)+'</a>').data('row',i);div.append(a);});$('a',div).click(function(e){var a=$(e.target);e.preventDefault();if(a.hasClass('active'))return;$('a',div).removeClass('active');a.addClass('active');update(a.data('row'));});div.appendTo('body');var fy=$('a:first',div).offset().top,ly=$('a:last',div).offset().top;if(fy!=ly){div.remove();return getFilterUI('select')(vis);}
return div;};if(type=='timescale')f=function(vis){var w=Math.min(vis.__w-30,Math.max(300,vis.__w*0.7)),timescale=d3.time.scale().domain([column.val(0),column.val(-1)]).range([0,w]),timesel=$('<div></div>').css({position:'relative',height:45,'margin-left':3}).addClass('filter-ui'),nticks=w/80,ticks=timescale.ticks(nticks),daysDelta=Math.round((column.val(-1).getTime()-column.val(0).getTime())/86400000),fmt=dw.utils.dateFormat(daysDelta),lfmt=column.type(true).formatter(),dots=timescale.ticks(w/8),lbl_x=function(i){return Math.max(-18,timescale(column.val(i))-40);};_.each(ticks,function(d){var s=$('<span>'+fmt(d)+'</span>'),x=timescale(d)-40,lw=vis.labelWidth(fmt(d));if(40-lw*0.5+x<0)x=-40+0.5*lw;s.css({position:'absolute',top:0,width:80,left:x,'text-align':'center',opacity:0.55});timesel.append(s);});_.each(dots,function(d){if(d.getTime()<column.val(0).getTime()||d.getTime()>column.val(-1).getTime())return;var s=$('<span class="dot"></span>');s.css({position:'absolute',bottom:19,width:1,height:'1ex','border-left':'1px solid #000','vertical-align':'bottom',left:Math.round(timescale(d))+0.5});if(!_.find(ticks,function(td){return d.getTime()==td.getTime();})){s.css({height:'0.6ex',opacity:0.5});}
timesel.append(s);});var pointer=$('<div>▲</div>').css({position:'absolute',width:20,bottom:2,left:timescale(column.val(active))-9,'text-align':'center'});timesel.append(pointer);var lbl=$('<div><span></span></div>').css({position:'absolute',width:80,top:0,left:lbl_x(active),'text-align':'center'}).data('last-txt',lfmt(column.val(active))).data('last-left',lbl_x(active));$('span',lbl).css({background:vis.theme().colors.background,'font-weight':'bold','padding':'0 1ex'}).html(lfmt(column.val(active)));timesel.append(lbl);$('<div />').css({position:'absolute',width:w+1,bottom:15,height:2,'border-bottom':'1px solid #000'}).appendTo(timesel);var bar=$('<div />').css({position:'absolute',left:0,width:w,height:40});timesel.append(bar);function nearest(rel_x){var x_date=timescale.invert(rel_x),min_dist=Number.MAX_VALUE,nearest_row=0;column.each(function(date,i){var dist=Math.abs(date.getTime()-x_date.getTime());if(dist<min_dist){min_dist=dist;nearest_row=i;}});return nearest_row;}
var autoClickTimer;bar.click(function(evt){var rel_x=evt.clientX-bar.offset().left,nearest_row=nearest(rel_x);update(nearest_row);timesel.data('update-func')(nearest_row);clearTimeout(autoClickTimer);});bar.mousemove(function(evt){var rel_x=evt.clientX-bar.offset().left,nearest_row=nearest(rel_x);$('span',lbl).html(lfmt(column.val(nearest_row)));lbl.css({left:lbl_x(nearest_row)});pointer.css({left:timescale(column.val(nearest_row))-10});clearTimeout(autoClickTimer);autoClickTimer=setTimeout(function(){update(nearest_row);lbl.data('last-left',lbl_x(nearest_row));lbl.data('last-txt',lbl.text());},500);});bar.mouseleave(function(){lbl.css({left:lbl.data('last-left')});pointer.css({left:lbl.data('last-left')+30});$('span',lbl).html(lbl.data('last-txt'));clearTimeout(autoClickTimer);});timesel.data('update-func',function(i){pointer.stop().animate({left:timescale(column.val(i))-10},500,'expoInOut');var l_x=lbl_x(i),lbl_txt=lfmt(column.val(i));$('span',lbl).html(lbl_txt);lbl.css({left:l_x});lbl.data('last-left',l_x);lbl.data('last-txt',lbl_txt);});return timesel;};return f;}
return filter;};dw.chart=function(attributes){var dataset,theme,visualization,metric_prefix,change_callbacks=$.Callbacks(),locale;var chart={get:function(key,_default){var keys=key.split('.'),pt=attributes;_.some(keys,function(key){if(_.isUndefined(pt)||_.isNull(pt))return true;pt=pt[key];return false;});return _.isUndefined(pt)||_.isNull(pt)?_default:pt;},set:function(key,value){var keys=key.split('.'),lastKey=keys.pop(),pt=attributes;_.each(keys,function(key){if(_.isUndefined(pt[key])||_.isNull(pt[key])){pt[key]={};}
pt=pt[key];});if(!_.isEqual(pt[lastKey],value)){pt[lastKey]=value;change_callbacks.fire(chart,key,value);}
return this;},load:function(){var datasource;datasource=dw.datasource.delimited({url:'data.csv',firstRowIsHeader:chart.get('metadata.data.horizontal-header',true),transpose:chart.get('metadata.data.transpose',false)});return datasource.dataset().pipe(function(ds){chart.dataset(ds);return ds;});},dataset:function(ds){if(arguments.length){dataset=applyChanges(ds);return chart;}
return dataset;},theme:function(_theme){if(arguments.length){theme=_theme;return chart;}
return theme||{};},vis:function(_vis){if(arguments.length){visualization=_vis;visualization.chart(chart);return chart;}
return visualization;},hasHighlight:function(){var hl=chart.get('metadata.visualize.highlighted-series');return _.isArray(hl)&&hl.length>0;},isHighlighted:function(obj){if(_.isUndefined(obj)===undefined)return false;var hl=this.get('metadata.visualize.highlighted-series'),obj_name=dw.utils.name(obj);return!_.isArray(hl)||hl.length===0||_.indexOf(hl,obj_name)>=0;},locale:function(_locale){if(arguments.length){locale=_locale;Globalize.culture(locale);return chart;}
return locale;},metricPrefix:function(_metric_prefix){if(arguments.length){metric_prefix=_metric_prefix;return chart;}
return metric_prefix;},formatValue:function(val,full,round){var format=chart.get('metadata.describe.number-format'),div=Number(chart.get('metadata.describe.number-divisor')),append=chart.get('metadata.describe.number-append','').replace(' ','&nbsp;'),prepend=chart.get('metadata.describe.number-prepend','').replace(' ','&nbsp;');if(div!==0)val=Number(val)/Math.pow(10,div);if(format!='-'){if(round||val==Math.round(val))format=format.substr(0,1)+'0';val=Globalize.format(val,format);}else if(div!==0){val=val.toFixed(1);}
return full?prepend+val+append:val;},render:function(container){if(!visualization||!theme||!dataset){throw'cannot render the chart!';}
visualization.chart(chart);visualization.__init();var $cont=$(container);$cont.parent().addClass('vis-'+visualization.id).addClass('theme-'+theme.id);visualization.render($cont);},attributes:function(attrs){if(arguments.length){attributes=attrs;return chart;}
return attributes;},onChange:change_callbacks.add,columnFormatter:function(column){var colFormat=chart.get('metadata.data.column-format',{});colFormat=colFormat[column.name()]||{};if(column.type()=='number'&&colFormat=='auto'){var mtrSuf=dw.utils.metricSuffix(chart.locale()),values=column.values(),dim=dw.utils.significantDimension(values),div=dim<-2?Math.round((dim*-1)/3)*3:dim>2?dim*-1:0;ndim=dw.utils.significantDimension(_.map(values,function(v){return v/Math.pow(10,div);}));colFormat={'number-divisor':div,'number-append':div?mtrSuf[div]||' × 10<sup>'+div+'</sup>':'','number-format':'n'+Math.max(0,ndim)};}
return column.type(true).formatter(colFormat);}};function applyChanges(dataset){var changes=chart.get('metadata.data.changes',[]);var transpose=chart.get('metadata.data.transpose',false);_.each(changes,function(change){var row="row",column="column";if(transpose){row="column";column="row";}
if(dataset.hasColumn(change[column])){if(change[row]===0){dataset.column(change[column]).title(change.value);}
else{dataset.column(change[column]).raw(change[row]-1,change.value);}}});var columnFormats=chart.get('metadata.data.column-format',{});_.each(columnFormats,function(columnFormat,key){if(columnFormat.type&&dataset.hasColumn(key)){dataset.column(key).type(columnFormat.type);}
if(columnFormat['input-format']&&dataset.hasColumn(key)){dataset.column(key).type(true).format(columnFormat['input-format']);}});return dataset;}
return chart;};dw.visualization=(function(){var __vis={};var visualization=function(id){return new __vis[id]();};visualization.register=function(id){var parent=arguments.length==3?__vis[arguments[1]].prototype:dw.visualization.base,props=arguments[arguments.length-1],vis=__vis[id]=function(){};_.extend(vis.prototype,parent,{id:id},props);};return visualization;})();dw.visualization.base=(function(){}).prototype;_.extend(dw.visualization.base,{__init:function(){this.__renderedDfd=$.Deferred();if(window.parent&&window.parent['postMessage']){window.parent.postMessage('datawrapper:vis:init','*');}
return this;},render:function(el){$(el).html('implement me!');},theme:function(theme){if(!arguments.length)return this.__theme;this.__theme=theme;var attr_properties=['horizontalGrid','verticalGrid','yAxis','xAxis'];_.each(attr_properties,function(prop){if(theme.hasOwnProperty(prop)){for(var key in theme[prop]){var lkey=key.replace(/([A-Z])/g,"-$1").toLowerCase();if(!theme[prop].hasOwnProperty(lkey)){theme[prop][lkey]=theme[prop][key];}}}});return this;},size:function(width,height){var me=this;if(!arguments.length)return[me.__w,me.__h];me.__w=width;me.__h=height;return me;},get:function(str,_default){return this.chart().get('metadata.visualize.'+str,_default);},notify:function(str){if(dw.backend&&_.isFunction(dw.backend.notify)){return dw.backend.notify(str);}else{if(window.parent&&window.parent['postMessage']){window.parent.postMessage('notify:'+str,'*');}else if(window['console']){console.log(str);}}},signature:function(){},translate:function(str){var locale=this.meta.locale,lang=this.lang;return locale[str]?locale[str][lang]||locale[str]:str;},checkBrowserCompatibility:function(){return true;},chart:function(chart){var me=this;if(!arguments.length)return me.__chart;me.dataset=chart.dataset();me.theme(chart.theme());me.__chart=chart;var columnFormat=chart.get('metadata.data.column-format',{});var ignore={};_.each(columnFormat,function(format,key){ignore[key]=!!format.ignore;});me.dataset.filterColumns(ignore);return me;},axes:function(returnAsColumns){var me=this,dataset=me.dataset,usedColumns={},axes={},axesDef,axesAsColumns={},errors=[];axesDef=me.chart().get('metadata.axes',{});_.each(me.meta.axes,function(o,key){if(axesDef[key]){var columns=axesDef[key];if(columnExists(columns)){axes[key]=columns;if(!_.isArray(columns))columns=[columns];_.each(columns,function(column){usedColumns[column]=true;});}}});_.each(me.meta.axes,function(axisDef,key){function checkColumn(col){return!usedColumns[col.name()]&&_.indexOf(axisDef.accepts,col.type())>=0;}
function errMissingColumn(){var msg=dw.backend?dw.backend.messages.insufficientData:'The visualization needs at least one column of the type %type to populate axis %key';errors.push(msg.replace('%type',axisDef.accepts).replace('%key',key));}
if(axes[key])return;if(!axisDef.optional){if(!axisDef.multiple){var c=_.find(dataset.columns(),checkColumn);if(c){usedColumns[c.name()]=true;axes[key]=c.name();}else{if(_.indexOf(axisDef.accepts,'text')>=0){var col=dw.column(key,_.map(_.range(dataset.numRows()),function(i){return(i>25?String.fromCharCode(64+i/26):'')+String.fromCharCode(65+(i%26));}),'text');dataset.add(col);me.chart().dataset(dataset);usedColumns[col.name()]=true;axes[key]=col.name();}else{errMissingColumn();}}}else{axes[key]=[];dataset.eachColumn(function(c){if(checkColumn(c)){usedColumns[c.name()]=true;axes[key].push(c.name());}});if(!axes[key].length){errMissingColumn();}}}else{axes[key]=false;}});if(errors.length){me.notify(errors.join('<br />'));}
_.each(axes,function(columns,key){if(!_.isArray(columns)){axesAsColumns[key]=columns!==false?me.dataset.column(columns):null;}else{axesAsColumns[key]=[];_.each(columns,function(column,i){axesAsColumns[key][i]=column!==false?me.dataset.column(column):null;});}});me.axes=function(returnAsColumns){return returnAsColumns?axesAsColumns:axes;};function columnExists(columns){if(!_.isArray(columns))columns=[columns];for(var i=0;i<columns.length;i++){if(!dataset.hasColumn(columns[i]))return false;}
return true;}
return me.axes(returnAsColumns);},keys:function(){var me=this,axesDef=me.axes();if(axesDef.labels){var lblCol=me.dataset.column(axesDef.labels),fmt=me.chart().columnFormatter(lblCol),keys=[];lblCol.each(function(val){keys.push(String(fmt(val)));});return keys;}
return[];},keyLabel:function(key){return key;},reset:function(){this.clear();$('#chart').html('').off('click').off('mousemove').off('mouseenter').off('mouseover');$('.chart .filter-ui').remove();$('.chart .legend').remove();},clear:function(){},renderingComplete:function(){if(window.parent&&window.parent['postMessage']){window.parent.postMessage('datawrapper:vis:rendered','*');}
this.__renderedDfd.resolve();},rendered:function(){return this.__renderedDfd.promise();},supportsSmartRendering:function(){return false;},_svgCanvas:function(){return false;}});dw.theme=(function(){var __themes={};var theme=function(id){return __themes[id];};theme.register=function(id){var parent=arguments.length==3?__themes[arguments[1]]:dw.theme.base,props=arguments[arguments.length-1];__themes[id]=extend({},parent,{id:id},props);};function extend(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length;if(typeof target!=="object"&&!_.isFunction(target)){target={};}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(copy&&isPlainObject(copy)){clone=src&&isPlainObject(src)?src:{};target[name]=extend(clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;}
function isPlainObject(o){return _.isObject(o)&&!_.isArray(o)&&!_.isFunction(o);}
return theme;})();dw.theme.base={colors:{palette:['#6E7DA1','#64A4C4','#53CCDD','#4EF4E8'],secondary:["#000000",'#777777','#cccccc','#ffd500','#6FAA12'],positive:'#85B4D4',negative:'#E31A1C',background:'#ffffff',text:'#000000',gradients:[['#fefaca','#008b15'],['#f0f9e8','#ccebc5','#a8ddb5','#7bccc4','#43a2ca','#0868ac'],['#feebe2','#fcc5c0','#fa9fb5','#f768a1','#c51b8a','#7a0177'],['#ffffcc','#c7e9b4','#7fcdbb','#41b6c4','#2c7fb8','#253494'],['#8c510a','#d8b365','#f6e8c3','#f5f7ea','#c7eae5','#5ab4ac','#01665e'],['#c51b7d','#e9a3c9','#fde0ef','#faf6ea','#e6f5d0','#a1d76a','#4d9221'],['#b2182b','#ef8a62','#fddbc7','#f8f6e9','#d1e5f0','#67a9cf','#2166ac'],],categories:[["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]]},padding:{left:0,right:20,bottom:30,top:10},lineChart:{strokeWidth:3,maxLabelWidth:80,fillOpacity:0.2,xLabelOffset:20},columnChart:{cutGridLines:false,barAttrs:{'stroke-width':1},darkenStroke:18},barChart:{barAttrs:{'stroke-width':1}},xAxis:{stroke:'#333'},yAxis:{strokeWidth:1},horizontalGrid:{stroke:'#d9d9d9'},verticalGrid:false,frame:false,frameStrokeOnTop:false,yTicks:false,hover:true,tooltip:true,hpadding:0,vpadding:10,minWidth:400,locale:'de_DE',duration:1000,easing:'expoInOut'};}).call(this);

(function(){dw.visualization.register('raphael-chart',{init:function(){this.__elements={};this.__labels={};},update:function(row){console.warn('vis.update(): override me!',row);},setRoot:function(el){var me=this;me.__root=el;el.css({position:'relative'});el.addClass(me.chart().get('type'));},getSize:function(){return[this.__w,this.__h];},initCanvas:function(canvas,w_sub,h_sub){var me=this,el=me.__root,size=me.size(),theme=me.theme();canvas=_.extend({w:size[0]-(w_sub||0),h:size[1]-(h_sub||0),rpad:theme.padding.right,lpad:theme.padding.left,bpad:theme.padding.bottom,tpad:theme.padding.top},canvas);if(size[0]<=400){canvas.bpad=canvas.tpad=canvas.lpad=canvas.rpad=5;canvas.bpad=canvas.tpad=15;}
canvas.root=el;canvas.paper=Raphael(el[0],canvas.w,canvas.h+2);el.height(canvas.h);$('.tooltip').hide();me.__canvas=canvas;Raphael.easing_formulas['expoInOut']=function(n,time,beg,diff,dur){dur=1000;time=n*1000;beg=0;diff=1;if(time===0)return beg;if(time==dur)return beg+diff;if((time/=dur/2)<1)return diff/2*Math.pow(2,10*(time-1))+beg;return diff/2*(-Math.pow(2,-10*--time)+2)+beg;};$.extend(jQuery.easing,{expoIn:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},expoOut:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},expoInOut:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;}});return canvas;},onMouseMove:function(e){var me=this,x=e.pageX,y=e.pageY,hovered_key=this.getKeyByPoint(x,y,e),row=this.getDataRowByPoint(x,y),theme=me.theme(),hoveredNode=hovered_key!==null;if(!hovered_key)hovered_key=me.getKeyByLabel();if(!hovered_key){clearTimeout(me.__mouseOverTimer);me.__mouseOutTimer=setTimeout(function(){clearTimeout(me.__mouseOverTimer);clearTimeout(me.__mouseOutTimer);if(theme.hover)me.hover();if(theme.tooltip)me.hideTooltip();},200);}else{if(me.__mouseOutTimer)clearTimeout(me.__mouseOutTimer);me.__mouseOverTimer=setTimeout(function(){clearTimeout(me.__mouseOverTimer);clearTimeout(me.__mouseOutTimer);if(theme.hover)me.hover(hovered_key);},100);}},registerElement:function(el,key,row){el.data('key',key);if(_.isNumber(row))el.data('row',row);if(!this.__elements[key]){this.__elements[key]=[];}
this.__elements[key].push(el);return el;},registerLabel:function(lbl,key,column,row){var me=this;lbl.data('key',key);if(column&&!_.isUndefined(row)){lbl.el.attr('data-column',column);lbl.el.attr('data-row',row);}
if(!me.__labels[key]){me.__labels[key]=[];}
me.__labels[key].push(lbl);lbl.on('mouseenter',function(e){me.__hoveredLabel=e.target;clearTimeout(me.__mouseLeaveTimer);});lbl.on('mouseleave',function(){me.__mouseLeaveTimer=setTimeout(function(){me.__hoveredLabel=null;},100);});return lbl;},getLabels:function(key){return this.__labels[key]||[];},hover:function(hover_key){var keyElements=this.__elements;_.each(keyElements,function(elements,key){var h=!hover_key||key==hover_key;_.each(elements,function(el){el.animate({opacity:h?1:0.5},80);});});var keyLabels=this.__labels;_.each(keyLabels,function(labels,key){var h=!hover_key||key==hover_key;_.each(labels,function(lbl){if(key==hover_key)lbl.addClass('highlighted');else lbl.removeClass('highlighted');});});},path:function(pathdata,className){var p=this.__canvas.paper.path(pathdata);if(className&&Raphael.svg){$(p.node).attr('class',className);}
return p;},label:function(x,y,txt,_attrs){var me=this,lbl,attrs={root:this.__canvas.root,align:'left',valign:'middle',cl:'',rotate:0,css:{position:'absolute',width:_attrs.w?_attrs.w:'auto'},x:x,y:y,txt:txt};$.extend(true,attrs,_attrs||{});lbl=$('<div class="label'+(attrs.cl?' '+attrs.cl:'')+'"><span>'+txt+'</span></div>');lbl.css(attrs.css);lbl.css({'text-align':attrs.align});attrs.root.append(lbl);function position(){var w=attrs.w||me.labelWidth(attrs.txt,attrs.cl,attrs.size),h=attrs.h||lbl.height(),x=attrs.x,y=attrs.y,rot_w=100;var css=attrs.rotate==-90?{left:x-rot_w*0.5,top:attrs.valign=='top'?y+rot_w*0.5:y-rot_w*0.5,width:rot_w,height:20,'text-align':attrs.valign=='top'?'right':'left'}:{left:attrs.align=='left'?x:attrs.align=='center'?x-w*0.5:x-w,top:y-h*(attrs.valign=='top'?0:attrs.valign=='middle'?0.5:1),width:w,height:h};if(attrs.size){css['font-size']=attrs.size;}
return css;}
lbl.css($.extend({},attrs.css,position()));if(attrs.rotate==-90){lbl.css({'-moz-transform':'rotate(-90deg)','-webkit-transform':'rotate(-90deg)','-ms-transform':'rotate(-90deg)','-o-transform':'rotate(-90deg)','filter':'progid:DXImageTransform.Microsoft.BasicImage(rotation=3)'});}
var label={el:lbl};label.text=function(txt){if(arguments.length){$('span',lbl).html(txt);return label;}
return $('span',lbl).html();};label.animate=function(_attrs,duration,easing){if(_attrs.align!=attrs.align){setTimeout(function(){lbl.css({'text-align':_attrs.align});},duration?duration*0.5:10);}
if(attrs.rotate&&_attrs.valign!=attrs.valign){setTimeout(function(){lbl.css({'text-align':_attrs.valign=='top'?'right':'left'});},duration?duration*0.5:10);}
if(_attrs.txt!=attrs.txt)label.text(_attrs.txt);$.extend(attrs,_attrs);var _css=$.extend({},attrs.css,position());return duration?lbl.stop().animate(_css,duration,easing):lbl.css(_css);};label.attr=label.animate;label.data=function(){return lbl.data.apply(lbl,arguments);};label.hide=function(){return lbl.hide.apply(lbl,arguments);};label.show=function(){return lbl.show.apply(lbl,arguments);};label.width=function(){return lbl.width.apply(lbl,arguments);};label.height=function(){return lbl.height.apply(lbl,arguments);};label.left=function(){return lbl.offset().left;};label.top=function(){return lbl.offset().top;};label.on=function(){return lbl.on.apply(lbl,arguments);};label.hasClass=function(){return lbl.hasClass.apply(lbl,arguments);};label.addClass=function(){return lbl.addClass.apply(lbl,arguments);};label.removeClass=function(){return lbl.removeClass.apply(lbl,arguments);};label.remove=function(){return lbl.remove.apply(lbl,arguments);};lbl.data('label',label);return label;},labelWidth:function(txt,className,fontSize){var lbl,span,$span,ow,root=this.__root.get(0);lbl=document.createElement('div');lbl.style.position='absolute';lbl.style.left='-10000px';span=document.createElement('span');lbl.appendChild(span);$span=$(span);root.appendChild(lbl);ow=!_.isUndefined(span.offsetWidth)?function(){return span.offsetWidth;}:function(){return $span.outerWidth();};function labelWidth(txt,className,fontSize){lbl.setAttribute('class','label '+(className?' '+className:''));span.style.fontSize=fontSize?fontSize:null;span.innerHTML=txt;return ow();}
this.labelWidth=labelWidth;return labelWidth(txt,className,fontSize);},labelHeight:function(txt,className,width,fontSize){var lbl,span,$span,oh,root=this.__root.get(0);lbl=document.createElement('div');lbl.style.position='absolute';lbl.style.left='-10000px';span=document.createElement('span');lbl.appendChild(span);$span=$(span);root.appendChild(lbl);oh=!_.isUndefined(span.offsetHeight)?function(){return span.offsetHeight;}:function(){return $span.height();};function labelHeight(txt,className,width,fontSize){lbl.setAttribute('class','label '+(className?' '+className:''));lbl.style.width=width+'px';span.style.fontSize=fontSize?fontSize:null;span.innerHTML=txt;return oh();}
this.labelHeight=labelHeight;return labelHeight(txt,className,width,fontSize);},orderSeriesElements:function(){var me=this;_.each(me.dataset.columns(),function(column){if(me.chart().isHighlighted(column)){_.each(me.__elements[column.name()],function(el){el.toFront();});}});},getKeyByPoint:function(x,y,evt){var me=this,el=me.__canvas.paper.getElementByPoint(x,y);if(!el){el=$(evt.target);if(!el.hasClass('label'))el=el.parents('.label');}
if(el&&el.data('key'))return el.data('key');return null;},getKeyByLabel:function(){var me=this;if(me.__hoveredLabel){lbl=$(me.__hoveredLabel);if(me.__hoveredLabel.nodeName.toLowerCase()=='span')lbl=lbl.parent();if(lbl.data('key'))return lbl.data('key');}
return null;},getDataRowByPoint:function(x,y){throw'getDataRowByPoint() needs to be implemented by each visualization';},_baseColor:function(){var me=this,base=me.get('base-color',0),palette=me.theme().colors.palette,fromPalette=!_.isString(base);return fromPalette?palette[base]:base;},_getColor:function(series,row,opts){var me=this,key=opts.key;if(!key&&series){key=series.name();}
if(key){var customColors=me.get('custom-colors',{});if(customColors[key])return customColors[key];}
if(opts.byValue&&series){return opts.byValue(series.val(row));}
if(series&&me.__colors&&me.__colors[key]){return me.__colors[key];}
var palette=me.theme().colors.palette,baseColor=me._baseColor();if(opts.usePalette){return palette[(Math.max(0,palette.indexOf(baseColor))+row)%palette.length];}
if(opts.varyLightness){var lab=chroma.color(baseColor).lab(),minL=Math.min(lab[0],50),maxL=91,f=row /(me.dataset.numRows()-1);return chroma.lab(minL+f*(maxL-minL),lab[1],lab[2]).hex();}
return baseColor;},getColor:function(series,row,opts){var me=this,chart=me.chart(),color=me._getColor(series,row,opts);if(series&&chart.hasHighlight()&&!chart.isHighlighted(series)){return chroma.interpolate(color,me.theme().colors.background,0.65,'rgb').hex();}
return color;},getKeyColor:function(_key,_value,_useNegativeColor,_colorful){var me=this,palette=me.theme().colors.palette,colorByRow=me.meta['color-by']=='row',colorCache={};function keyColor(key,value,useNegativeColor,colorful){var color;key=String(key);var userCustomColors=me.get('custom-colors',{});if(userCustomColors[key]){color=userCustomColors[key];}else if(value&&useNegativeColor){color=me.theme().colors[value<0?'negative':'positive'];}else{if(key&&me.__customColors&&me.__customColors[key])
color=me.__customColors[key];else color=me._baseColor();}
var key_color=chroma.hex(color),bg_color=chroma.hex(me.theme().colors.background),bg_lch=bg_color.lch();if(key&&!me.chart().isHighlighted(key)){if(!colorCache[color+'-hl']){colorCache[color+'-hl']=chroma.interpolate(key_color,bg_color,bg_lch[0]<60?0.7:0.63);}
return colorCache[color+'-hl'];}
return color;}
me.getKeyColor=keyColor;return keyColor(_key,_value,_useNegativeColor,_colorful);},setKeyColor:function(key,color){var me=this;if(!me.__customColors)me.__customColors={};me.__customColors[key]=color;},getYTicks:function(yscale,h,noDomain,useLogScale){var me=this,domain=yscale.domain(),ticks=useLogScale?dw.utils.logTicks(domain[0],domain[1]):yscale.ticks(h / 80),bt=yscale(ticks[0]),tt=yscale(ticks[ticks.length-1]);if(!noDomain){if(Math.abs(yscale(domain[0])-bt)<30)ticks.shift();if(Math.abs(tt-yscale(domain[1]))<30)ticks.pop();ticks.unshift(domain[0]);ticks.push(domain[1]);}
return ticks;},invertLabel:function(col){var c=chroma.color(col),bg=chroma.color(this.theme().colors.background);return bg.lab()[0]>60?c.lab()[0]<80:c.lab()[0]>60;},signature:function(){var me=this,sig={type:'raphael-chart',el:{}};$.each(me.__elements,function(key,elements){sig.el[key]=elements.length;});return sig;},addLegend:function(items,container){var me=this,l=$('<div class="legend"></div>'),xo=me.__canvas.lpad;_.each(items,function(item){div=$('<div></div>');div.css({background:item.color,width:12,height:12,position:'absolute',left:xo,top:1});l.append(div);lbl=me.label(xo+15,0,item.label,{valign:'left',root:l});xo+=me.labelWidth(item.label)+30;});l.css({position:'relative'});container.append(l);},optimizeLabelPositions:function(labels,pad,valign){if(!labels.length)return;var i=1,c=valign=='top'?0:valign=='middle'?0.5:1,min_y=labels[0].el.parent().offset().top,max_y=min_y+labels[0].el.parent().height();labels=_.filter(labels,function(lbl){return lbl.el.is(":visible");});if(!labels.length)return;_.each(labels,function(lbl){lbl.__noverlap={otop:lbl.top(),top:lbl.top(),dy:0};lbl.height('auto');});(function loop(){var overlap=false;_.each(labels,function(lbl0,p){_.each(labels,function(lbl1,q){if(q>p){var l0=lbl0.left(),l1=lbl1.left(),r0=l0+lbl0.width(),r1=l1+lbl1.width(),t0=lbl0.__noverlap.top-pad,t1=lbl1.__noverlap.top-pad,b0=t0+lbl0.height()+pad*2,b1=t1+lbl1.height()+pad*2,dy,l0up;if(!(l1>r0||r1<l0||t1>b0||b1<t0)){overlap=true;dy=Math.min(b0,b1)-Math.max(t0,t1);l0up=t0+(b0-t0)*c<t1+(b1-t1)*c;lbl0.__noverlap.dy+=dy*0.5*(l0up?-1:1);lbl1.__noverlap.dy+=dy*0.5*(l0up?1:-1);}}});});if(overlap){_.each(labels,function(lbl){lbl.__noverlap.top=Math.max(min_y,lbl.__noverlap.top+lbl.__noverlap.dy);lbl.__noverlap.dy=0;});}
if(overlap&&++i<10)loop();})();_.each(labels,function(lbl){lbl.el.css({top:lbl.__noverlap.top-lbl.el.parent().offset().top});});},checkBrowserCompatibility:function(){return window['Raphael']&&Raphael.type;},clear:function(){var me=this;_.each(me.__elements,function(elements){_.each(elements,function(el){el.remove();});});_.each(me.__labels,function(elements){_.each(elements,function(el){el.remove();});});me.__elements={};me.__labels={};},_svgCanvas:function(){return this.__canvas.paper.canvas;}});}).call(this);(function(){var lastTime=0;var vendors=['ms','moz','webkit','o'];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(!window.requestAnimationFrame)
window.requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};if(!window.cancelAnimationFrame)
window.cancelAnimationFrame=function(id){clearTimeout(id);};}());(function(){dw.visualization.register('column-chart','raphael-chart',{render:function(el){var me=this,filter,filterUI,sortBars,reverse,c,dataset=me.dataset,chart_width,column_gap,row_gap,row,column,bars,theme=me.theme();me.axesDef=me.axes();if(!me.axesDef)return;this.setRoot(el);row=0;if(!_.isUndefined(me.get('selected-row'))){row=me.get('selected-row',0);if(row>dataset.numRows())row=0;}
me.__lastRow=row;var barColumns=_.map(me.axesDef.columns,function(i){return dataset.column(i);});filter=dw.utils.filter(dw.utils.columnNameColumn(barColumns),row);filterUI=filter.ui(me);var filterH=0;if(filterUI)(function(){var $h=$('#header'),oldHeaderHeight=$h.height();$h.append(filterUI);filterH=$h.height()-oldHeaderHeight;filter.change(function(val,i){me.__lastRow=i;me.update(i);});})();sortBars=me.get('sort-values');reverse=me.get('reverse-order');c=me.initCanvas({},0,filterH);chart_width=c.w-c.lpad-c.rpad;column_gap=0.05;row_gap=0.01;if(filterUI)c.tpad+=5;me.init();column=me.getBarColumn();if(!column)return;bars=me.getBarValues();var lh=0,mm=column.range(),mm_r=mm[0]>=0?1:mm[1]<=0?0:mm[1]/(mm[1]-mm[0]),n=me.__n=bars.length;_.each(bars,function(bar,s){lh=Math.max(lh,chart_width /(n+(n-1)*0.35)>38?me.labelHeight(bar.name,'series',c.w /(n)):Math.min(80,me.labelWidth(bar.name,'series')));});c.bpad=c.bpad-30+lh*mm_r+15;c.tpad+=lh*(1-mm_r);me.initDimensions();$('.tooltip').hide();if(!theme.columnChart.cutGridLines)me.horzGrid();_.each(me.getBarValues(sortBars,reverse),_.bind(me.__barEnter,me));var y=c.h-me.__scales.y(0)-c.bpad;el.mousemove(_.bind(me.onMouseMove,me));$('.showOnHover').hide();if(theme.columnChart.cutGridLines)me.horzGrid();if(me.__gridLines&&me.__gridLines['0'])me.__gridLines['0'].toFront();me.renderingComplete();},__barEnter:function(barv,s){var me=this,c=me.__canvas,d=me.barDimensions(barv,s),n=me.__n,chart=me.chart(),theme=me.theme(),val=barv.value,fill=me.getBarColor(barv,me.get('negative-color',false)),stroke=chroma.color(fill).darken(theme.columnChart.darkenStroke).hex(),bar,formatter=chart.columnFormatter(me.getBarColumn());bar=me.registerElement(c.paper.rect().attr(d).attr({'stroke':stroke,'fill':fill}).data('strokeCol',stroke),barv.name);if(theme.columnChart.barAttrs){bar.attr(theme.columnChart.barAttrs);}
var val_y=val>0?d.y-10:d.y+d.height+10,lbl_y=val<=0?d.y-10:d.y+d.height+5,f_val=formatter(val,true),vlbl_w=me.labelWidth(f_val,'value'),bw=(d.width+d.width*d.pad),lblcl=['series'],lbl_w=c.w /(n+2),valign=val>0?'top':'bottom',halign='center',alwaysShow=(chart.hasHighlight()&&chart.isHighlighted(barv.name))||(bw>vlbl_w);var lpos=me.labelPosition(barv,s,'value'),spos=me.labelPosition(barv,s,'series');me.registerLabel(me.label(lpos.left,lpos.top,formatter(barv.value,true),{w:lpos.width,align:'center',cl:'value outline '+(alwaysShow?'':' showOnHover')}),barv.name);if(chart.hasHighlight()&&chart.isHighlighted(barv.name)){lblcl.push('highlighted');}
if(d.bw<30){halign='right';}
if(d.bw<20){lblcl.push('smaller');}
if(!/^X\.\d+$/.test(barv.name)){me.registerLabel(me.label(spos.left,spos.top,barv.name,{w:spos.width,align:spos.halign,valign:spos.valign,cl:lblcl.join(' '),rotate:d.bw<30?-90:0}),barv.name,me.axes().labels,barv.row);}},__barExit:function(bar_name,s){var me=this;_.each(me.__elements[bar_name],function(el){el.remove();});_.each(me.__labels[bar_name],function(el){el.remove();});me.__elements[bar_name]=undefined;me.__labels[bar_name]=undefined;},getBarValues:function(sortBars,reverse){var me=this,values=[],filter=me.__lastRow,labels=me.dataset.column(me.axesDef.labels),column=me.getBarColumn(filter),fmt=labels.type(true).formatter();column.each(function(val,i){if(!isNaN(val)||!me.get('ignore-missing-values',false)){values.push({name:fmt(labels.val(i)),value:val,row:i});}});if(sortBars)values.sort(function(a,b){return(isNaN(b.value)?0:b.value)-(isNaN(a.value)?0:a.value);});if(reverse)values.reverse();return values;},getBarColumn:function(){var me=this,filter=me.__lastRow;if(_.isUndefined(filter))throw'filter must not be undefined';if(_.isUndefined(me.axesDef.columns[filter]))return null;return me.dataset.column(me.axesDef.columns[filter]);},update:function(row){var me=this,theme=me.theme(),formatter=me.chart().columnFormatter(me.getBarColumn());me.initDimensions();me.horzGrid();var n=me.__n=me.getBarValues().length,updated_bars={};_.each(me.getBarValues(me.get('sort-values'),me.get('reverse-order')),function(bar,s){if(!me.__elements[bar.name])me.__barEnter(bar,s);_.each(me.__elements[bar.name],function(rect){var dim=me.barDimensions(bar,s,0);rect.animate(dim,theme.duration,theme.easing);});_.each(me.__labels[bar.name],function(lbl){var lpos;if(lbl.hasClass('value')){lbl.text(formatter(bar.value,true));lpos=me.labelPosition(bar,s,'value');}else if(lbl.hasClass('series')){lpos=me.labelPosition(bar,s,'series');}
if(lpos){lbl.animate({x:lpos.left,y:lpos.top,align:lpos.halign,valign:lpos.valign},theme.duration,theme.easing);}});updated_bars[bar.name]=true;});_.each(me.__elements,function(elements,key){if(!updated_bars[key]){me.__barExit(key);}});if(me.__gridLines['0'])me.__gridLines['0'].toFront();},getBarColor:function(bar,useNegativeColor,colorful){var me=this;return me.getKeyColor(bar?bar.name:null,bar?bar.value:null,useNegativeColor);},initDimensions:function(r){var me=this,c=me.__canvas,domain=me.getBarColumn().range();if(me.get('absolute-scale',false)){domain=dw.utils.minMax(_.map(me.axesDef.columns,function(c){return me.dataset.column(c);}));}
if(domain[0]>0)domain[0]=0;if(domain[1]<0)domain[1]=0;me.__domain=domain;me.__scales={y:d3.scale.linear().domain(domain)};me.__scales.y.rangeRound([0,c.h-c.bpad-c.tpad]);},barDimensions:function(bar,s){var me=this,sc=me.__scales,c=me.__canvas,n=me.getBarValues().length,w,h,x,y,i,cw,bw,pad=0.35,vspace=0.1,val=bar.value;if(isNaN(val))val=0;if(c.w / n<30)vspace=0.05;if(!me.gridVisible())vspace=0.02;cw=(c.w-c.lpad-c.rpad)*(1-vspace-vspace);bw=cw /(n+(n-1)*pad);if(bw<10){bw=2;pad=((cw / bw)-n)/(n-1);}
h=sc.y(val)-sc.y(0);w=Math.round(bw);if(h>=0){y=c.h-c.bpad-sc.y(0)-h;}else{y=c.h-c.bpad-sc.y(0);h*=-1;}
if(h!==0)h=Math.max(1,h);x=Math.round((c.w-c.lpad-c.rpad)*vspace+c.lpad+s*(bw+bw*pad));return{width:w,height:h,x:x,y:y,bx:x,bw:bw,pad:pad};},labelPosition:function(bar,s,type){var me=this,d=me.barDimensions(bar,s),lbl_w,val=bar.value,c=me.__canvas,lbl_top=val>=0||isNaN(val),valign=lbl_top?'top':'bottom',halign='center',val_y=lbl_top?d.y-10:d.y+d.height+10,lbl_y=!lbl_top?d.y-5:d.y+d.height+5,formatter=me.chart().columnFormatter(me.getBarColumn());if(type=="value"){lbl_w=me.labelWidth(formatter(val,true),'value outline hover');return{left:d.x+d.width*0.5,top:val_y,width:lbl_w};}else if(type=="series"){lbl_w=c.w /(me.getBarValues().length+2);if(d.bw<30){lbl_y-=10;lbl_w=100;halign='right';}
if(d.bw<20){lbl_w=90;}
return{left:d.bx+d.bw*0.5,top:lbl_y,width:lbl_w,halign:halign,valign:valign};}},getDataRowByPoint:function(x,y){return 0;},showTooltip:function(){},hideTooltip:function(){},horzGrid:function(){var me=this,yscale=me.__scales.y,c=me.__canvas,domain=me.__domain,styles=me.__styles,theme=me.theme(),ticks=me.getYTicks(yscale,c.h,true),tickLabels=me.__tickLabels=me.__tickLabels||{},gridLines=me.__gridLines=me.__gridLines||{},formatter=me.chart().columnFormatter(me.getBarColumn());if(!me.gridVisible())ticks=[];ticks=ticks.filter(function(val,t){return val>=domain[0]&&val<=domain[1];});_.each(ticks,function(val,t){var y=c.h-c.bpad-yscale(val),x=c.lpad,ly=y-10;if(theme.columnChart.cutGridLines)ly+=10;var key=String(val);if(val!==0){var lbl=tickLabels[key]=tickLabels[key]||me.label(x+2,ly,formatter(val,t==ticks.length-1,true),{align:'left',cl:'axis',css:{opacity:0}});lbl.animate({x:c.lpad+2,y:ly,css:{opacity:1}},theme.duration,theme.easing);}
if(theme.yTicks){me.path([['M',c.lpad-25,y],['L',c.lpad-20,y]],'tick');}
if(theme.horizontalGrid){var lattrs={path:[['M',c.lpad,y],['L',c.w-c.rpad,y]],opacity:1},l=gridLines[key]=gridLines[key]||me.path(lattrs.path,'grid');l.toBack();if(val===0){$.extend(lattrs,theme.xAxis);l.toFront();}else{l.attr(theme.horizontalGrid);$.extend(lattrs,theme.horizontalGrid);}
if(!me.__lastTicks||_.indexOf(me.__lastTicks,Number(val))<0){var old_path=lattrs.path;if(me.__lastDomain){yscale.domain(me.__lastDomain);y=c.h-c.bpad-yscale(val);yscale.domain(domain);old_path=[['M',c.lpad,y],['L',c.w-c.rpad,y]];}
l.attr({opacity:0,path:old_path});}
if(val!==0&&theme.columnChart.cutGridLines)lattrs.stroke=theme.colors.background;l.animate(lattrs,theme.duration*(me.__lastTicks?1:0.2),theme.easing);}});$.each(gridLines,function(val,line){if(_.indexOf(ticks,+val)<0){var y=c.h-c.bpad-yscale(val),props={};$.extend(props,theme.horizontalGrid,{path:[['M',c.lpad,y],['L',c.w-c.rpad,y]],opacity:0});line.animate(props,theme.duration,theme.easing);if(tickLabels[val]){var lbl=tickLabels[val];tickLabels[val].animate({x:c.lpad+2,y:y+(theme.columnChart.cutGridLines?-10:0),css:{opacity:0}},theme.duration,theme.easing);}}});me.__lastTicks=ticks;me.__lastDomain=domain.slice(0);},hovers:function(column){var me=this,theme=me.theme();_.each(me.getBarColumns(),function(col){_.each(me.__labels[col.name()],function(lbl){if(column!==undefined&&col.name()==column.name()){lbl.addClass('hover');if(lbl.hasClass('showOnHover'))lbl.show(0.5);}else{lbl.removeClass('hover');if(lbl.hasClass('showOnHover'))lbl.hide(0.5);}
_.each(me.__elements[col.name()],function(el){var fill=me.getBarColor(col,el.data('row'),me.get('negative-color',false)),stroke;if(column!==undefined&&col.name()==column.name())fill=chroma.color(fill).darken(14).hex();stroke=chroma.color(fill).darken(theme.columnChart.darkenStroke).hex();if(el.attrs.fill!=fill||el.attrs.stroke!=stroke)
el.animate({fill:fill,stroke:stroke},50);});});});},unhoverSeries:function(){this.hoverSeries();},gridVisible:function(){var me=this;return me.get('grid-lines','show')=='show'?true:me.get('grid-lines')=='hide'?false:(me.__canvas.w / me.getBarValues().length)<50||me.getBarValues().length>8;}});}).call(this);